query AllRelevantEntities(
  $block: Block_height
  $accounts: [String!]!
  $accounts_bytes: [ID!]!
  $tokens: [String!]!
) {
  poolDistributors(
    block: $block
    first: 1000
    where: { account_in: $accounts, pool_: { token_in: $tokens } }
  ) {
    createdAtBlockNumber
    createdAtTimestamp
    updatedAtBlockNumber
    updatedAtTimestamp
    flowRate
    account {
      id
      isSuperApp
    }
    pool {
      createdAtBlockNumber
      createdAtTimestamp
      updatedAtBlockNumber
      updatedAtTimestamp
      id
      token {
        id
      }
      # should pool members be included here?
    }
  }
  poolMembers(block: $block, first: 1000, where: { account_in: $accounts }) {
    createdAtBlockNumber
    createdAtTimestamp
    updatedAtBlockNumber
    updatedAtTimestamp
    units
    account {
      id
      isSuperApp
    }
    pool {
      createdAtBlockNumber
      createdAtTimestamp
      updatedAtBlockNumber
      updatedAtTimestamp
      id
      flowRate
      totalUnits
      # poolDistributors(block: $block, first: 1000) {
      #   flowRate
      #   account {
      #     id
      #     isSuperApp
      #   }
      # }
      token {
        id
      }
    }
  }
  streams(
    block: $block
    first: 1000
    where: {
      or: [
        { receiver_in: $accounts, token_in: $tokens }
        { sender_in: $accounts, token_in: $tokens }
      ]
    }
  ) {
    createdAtBlockNumber
    createdAtTimestamp
    updatedAtBlockNumber
    updatedAtTimestamp
    receiver {
      id
      isSuperApp
    }
    sender {
      id
      isSuperApp
    }
    token {
      id
    }
    currentFlowRate
  }
  accounts(where: { id_in: $accounts_bytes }) {
    id
    isSuperApp
    createdAtBlockNumber
    createdAtTimestamp
    updatedAtBlockNumber
    updatedAtTimestamp
  }
}
