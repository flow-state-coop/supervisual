query AllRelevantEntities(
  $block: Block_height
  $accounts: [String!]!
  $accounts_bytes: [ID!]!
  $tokens: [String!]!
) {
  poolDistributors(
    block: $block
    first: 1000
    where: {
      account_in: $accounts
      pool_: { token_in: $tokens }
      flowRate_not: "0"
    }
  ) {
    createdAtBlockNumber
    createdAtTimestamp
    updatedAtBlockNumber
    updatedAtTimestamp
    flowRate
    account {
      id
      isSuperApp
    }
    pool {
      createdAtBlockNumber
      createdAtTimestamp
      updatedAtBlockNumber
      updatedAtTimestamp
      id
      token {
        id
      }
    }
  }
  poolMembers(
    block: $block
    first: 1000
    where: {
      account_in: $accounts
      units_not: "0"
      pool_: { flowRate_not: "0" }
    }
  ) {
    createdAtBlockNumber
    createdAtTimestamp
    updatedAtBlockNumber
    updatedAtTimestamp
    units
    account {
      id
      isSuperApp
    }
    pool {
      createdAtBlockNumber
      createdAtTimestamp
      updatedAtBlockNumber
      updatedAtTimestamp
      id
      flowRate
      totalUnits
      token {
        id
      }
    }
  }
  streams(
    block: $block
    first: 1000
    where: {
      or: [
        { receiver_in: $accounts, token_in: $tokens, currentFlowRate_gt: 0 }
        { sender_in: $accounts, token_in: $tokens, currentFlowRate_gt: 0 }
      ]
    }
  ) {
    createdAtBlockNumber
    createdAtTimestamp
    updatedAtBlockNumber
    updatedAtTimestamp
    receiver {
      id
      isSuperApp
    }
    sender {
      id
      isSuperApp
    }
    token {
      id
    }
    currentFlowRate
  }
  accounts(where: { id_in: $accounts_bytes }) {
    id
    isSuperApp
    createdAtBlockNumber
    createdAtTimestamp
    updatedAtBlockNumber
    updatedAtTimestamp
  }
  _meta {
    block {
      number
      timestamp
    }
  }
}
